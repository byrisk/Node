port: 7890
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
unified-delay: true
global-client-fingerprint: chrome
external-controller: :9090

dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  listen: 0.0.0.0:7874
  nameserver:
    - tls://1.1.1.1
    - tls://8.8.8.8
    - https://cloudflare-dns.com/dns-query
  default-nameserver:
    - 119.29.29.29
    - 223.5.5.5
  fallback:
    - tls://1.0.0.1:853
    - tls://8.8.4.4:853
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - 'localhost.ptlogin2.qq.com'
    - 'dns.msftncsi.com'
    - 'www.msftncsi.com'
    - 'www.msftconnecttest.com'

### 锚点定义
fly: &fly 
  type: url-test
  url: "http://www.google.com/generate_204"
  interval: 300
  tolerance: 50
  lazy: true

fly2: &fly2 
  type: url-test
  url: "http://www.google.com/generate_204"
  interval: 300
  tolerance: 50
  lazy: true

all: &all 
  type: select

p: &p 
  type: http
  interval: 21600
  health-check: 
    enable: true
    url: "http://www.google.com/generate_204"
    interval: 1800
    filter: "(?i)^(?!unavailable).*$"

### 代理提供商
proxy-providers:
  订阅1:
    <<: *p
    url: "https://gist.githubusercontent.com/byrisk/904fcf74c6299b728fb2b83d621832dd/raw/a99002f6e03bc9eca0d7ea4a4af533f0dd8a8760/MQconfig"
    path: ./providers/订阅1.yaml

  订阅2:
    <<: *p
    url: "https://gist.githubusercontent.com/byrisk/172280d15a99a420c2ec0d190be8e40a/raw/515ae2eddd954116eee7330af025e617b084a7fa/all.yaml"
    path: ./providers/订阅2.yaml

  订阅3:
    <<: *p
    url: "https://linuxdo.862368.xyz/proxy.php"  # 改为HTTPS
    path: ./providers/订阅3.yaml

### 代理组
proxy-groups:
  - name: 🚀 自动选择(推荐_自用高速)
    <<: *fly
    use: [订阅1]
    filter: "(?i)^(?!unavailable).*$"
  
  - name: 🚀节点选择(推荐_自用高速)
    <<: *all
    use: [订阅1]
    filter: "(?i)^(?!unavailable).*$"
  
  - name: 🚀 自动选择(备用)
    <<: *fly2
    use: [订阅2, 订阅3]
    filter: "(?i)^(?!unavailable).*$"

  - name: 🌏️ 节点选择(All)
    <<: *all
    use: [订阅1, 订阅2, 订阅3]
    filter: "(?i)^(?!unavailable).*$"

  - name: 🔀 AI 服务
    type: select
    proxies:
      - ✅ 解锁 AI
      - DIRECT

  - name: ✅ 解锁 AI
    type: url-test
    url: "http://www.google.com/generate_204"
    interval: 120
    tolerance: 50
    lazy: true
    use: [订阅1, 订阅2, 订阅3]
    filter: "(?!.*(hong kong|hk|香港|香|港|香港 01))"

  - name: ⛔️ 拦截广告
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name: ↪️ 漏网之鱼
    type: select
    proxies:
      - 🌏️ 节点选择(All)
      - 🚀节点选择(推荐_自用高速)
      - 🚀 自动选择(推荐_自用高速)
      - DIRECT

### 规则
rules:
  # AI服务
  - DOMAIN-SUFFIX,openai.com,🔀 AI 服务
  - DOMAIN-SUFFIX,anthropic.com,🔀 AI 服务
  - DOMAIN-SUFFIX,claude.ai,🔀 AI 服务
  - DOMAIN-SUFFIX,gemini.google.com,🔀 AI 服务
  - DOMAIN-KEYWORD,openai,🔀 AI 服务
  - RULE-SET,ai,🔀 AI 服务

  # 广告拦截
  - RULE-SET,reject,⛔️ 拦截广告
  - DOMAIN-SUFFIX,adobe.io,REJECT
  - DOMAIN-SUFFIX,adobestats.io,REJECT

  # 国内直连
  - RULE-SET,private,DIRECT
  - RULE-SET,cncidr,DIRECT
  - RULE-SET,china,DIRECT
  - GEOIP,CN,DIRECT

  # 代理规则
  - RULE-SET,proxy,🌏️ 节点选择(All)
  - RULE-SET,gfw,🌏️ 节点选择(All)
  - RULE-SET,tld-not-cn,🌏️ 节点选择(All)

  # 最终规则
  - MATCH,↪️ 漏网之鱼

### 规则集
rule-providers:
  ai:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/ai.txt"
    path: ./ruleset/ai.yaml
    interval: 86400

  reject:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: ./ruleset/reject.yaml
    interval: 86400

  private:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: ./ruleset/private.yaml
    interval: 86400

  cncidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./ruleset/cncidr.yaml
    interval: 86400

  china:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/china.txt"
    path: ./ruleset/china.yaml
    interval: 86400

  proxy:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: ./ruleset/proxy.yaml
    interval: 86400

  gfw:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt"
    path: ./ruleset/gfw.yaml
    interval: 86400

  tld-not-cn:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt"
    path: ./ruleset/tld-not-cn.yaml
    interval: 86400
